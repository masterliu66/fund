# Feature Specification: 基金估值分析应用

**Feature Branch**: `001-fund-valuation`  
**Created**: 2025-11-28  
**Status**: Draft  
**Input**: User description: "开发一个应用，用于收集指定code的基金数据，包含基金的历史最高/最低净值、当日估值等信息，分析基金当前是否处于高估/低估状态，是否适合投资，与预期投资收益等"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 查询单只基金估值概览 (Priority: P1)

一名投资者输入或选择一只基金代码，希望快速看到该基金的
- 当前估算净值（当日估值）
- 历史最高/最低净值
- 近期区间表现（如近 1 月 / 3 月 / 1 年）
- 当前估值大致处于高估、合理、还是低估区间的标签

**Why this priority**: 这是所有后续分析的基础场景，必须先保障单只基金估值信息准确、可视化清晰。

**Independent Test**:  
在仅开启「单只基金估值概览」功能的情况下，用户可以通过输入代码，完成从查询到阅读估值结论的完整闭环，不依赖其他功能。

**Acceptance Scenarios**:

1. **Given** 用户在应用中输入一只有效基金代码，  
   **When** 系统成功获取该基金的历史净值与当日估值数据，  
   **Then** 页面应展示：当日估值、历史最高净值、历史最低净值、指定时间区间收益率，以及一个清晰的估值状态标签（如「高估」「低估」「合理」）。

2. **Given** 用户输入一只无效或已下架基金代码，  
   **When** 数据源无法返回有效数据，  
   **Then** 系统应给出清晰的错误提示，不崩溃，并引导用户检查代码或更换基金。

---

### User Story 2 - 对比多只基金当前估值与预期收益 (Priority: P2)

一名投资者希望对比多只候选基金，在同一视图下查看：
- 当前估值状态（高估/合理/低估）
- 预期年化收益区间（基于用户配置的目标收益假设）
- 主要风险提示或波动信息概览

**Why this priority**: 投资决策通常在多只基金之间权衡，对比视图能显著提升决策效率和体验。

**Independent Test**:  
即使只实现多基金估值对比视图（在已有单基金查询能力的前提下），用户仍能通过添加多只基金、查看对比结论，完成独立的决策过程。

**Acceptance Scenarios**:

1. **Given** 用户已成功添加至少 2 只基金到对比列表，  
   **When** 用户打开对比视图，  
   **Then** 系统应在同一界面列出这些基金的名称、代码、当前估值状态标签、近一段时间收益表现，以及估算的预期年化收益区间。

2. **Given** 用户修改全局或单只基金的目标收益假设参数（如期望收益率、持有期限），  
   **When** 保存设置后重新计算，  
   **Then** 对比视图中的预期收益区间应随之更新，且有明显的状态提示已根据新假设重算。

---

### User Story 3 - 评估当前是否适合买入/加仓 (Priority: P3)

一名已有一定持仓或准备建仓的投资者，希望系统给出简单直观的「是否适合投资」建议，例如：
- 「当前估值偏高，建议谨慎」
- 「当前处于历史中低位，可分批建仓」
- 并可查看该建议背后的主要依据（估值分位、历史回撤、预期收益与风险匹配等，呈现为非技术性描述）。

**Why this priority**: 用户最终关心的是「现在该不该买」，该建议在 UX 层面提升最大。

**Independent Test**:  
在已有估值计算能力基础上，即便只实现投资建议模块，用户也能单独访问某只基金的「是否适合投资」结论及解释说明。

**Acceptance Scenarios**:

1. **Given** 用户查看某只基金详情页面，  
   **When** 所需估值与历史数据已准备就绪，  
   **Then** 页面应显示一条清晰的投资建议结论（例如「适合分批建仓」），以及不超过 3 条要点解释，语言面向普通投资者，而非技术人员。

2. **Given** 数据不完整或超出模型适用范围（例如历史数据不足某阈值），  
   **When** 系统无法合理生成建议，  
   **Then** 应展示「暂无法给出可靠建议」之类的友好提示，并简要说明原因，而不是给出误导性的结论。

---

### Edge Cases

- 当某只基金的历史数据长度不足（例如上市时间很短），如何处理估值分位与高低估判断？  
- 当数据提供方在当日估值字段中返回空值或异常值时，系统如何在 UI 上提示并避免误导用户？  
- 当用户添加过多只基金到对比列表（例如 50 只以上），列表如何在性能和可读性上做平衡？

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统 MUST 允许用户通过基金代码搜索并选择单只基金，查看其当日估值、历史最高/最低净值及指定时间区间收益率。
- **FR-002**: 系统 MUST 为每只基金计算并展示一个当前估值状态标签（例如「高估」「低估」「合理」），并基于可配置的估值区间规则实现。
- **FR-003**: 系统 MUST 允许用户维护一个「自选基金列表」，并在对比视图中同时展示多只基金的当前估值状态和关键指标。
- **FR-004**: 系统 MUST 支持用户配置用于预期收益估算的关键假设参数（如目标持有期限、目标年化收益率区间），并基于这些参数估算每只基金的预期收益区间。
- **FR-005**: 系统 MUST 在基金详情页面给出「是否适合当前投资」的结论文案，以及对应的简要依据说明，语言应面向普通投资者。
- **FR-006**: 当数据源返回错误、缺失或超时，系统 MUST 提供清晰的错误提示，并避免展示明显错误的估值或建议。
- **FR-007**: 系统 MUST 记录用户的基金选择和关键配置（例如自选列表、预期收益参数），以便用户下次打开应用时可以延续使用体验。

### Key Entities *(include if feature involves data)*

- **Fund**: 表示单只基金的基础信息（代码、名称、类型等），以及关联的历史净值和当日估值数据。
- **FundNavHistory**: 表示某只基金在某一日期的净值及相关数据，用于统计历史高低点和分位。
- **FundInfoReport**: 表示聚合后的基金估值分析结果，供前端列表和详情展示。
- **UserWatchlist**: 表示用户维护的自选基金集合（如后续实现）。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户在输入有效基金代码后，90% 的情况下可以在 3 秒内看到完整的估值信息和估值标签。
- **SC-002**: 对比视图下，用户可以在不超过 1 分钟内基于应用提供的信息完成多只基金间的初步筛选和排序决策（以用户调研或可用性测试为依据）。
- **SC-003**: 在功能上线后的首个完整月内，与基金估值相关的错误工单或用户投诉比例低于全部工单的 5%。
- **SC-004**: 在可用性测试中，至少 80% 的测试用户表示「能够理解应用给出的基金是否适合投资的原因说明」。
