<html lang="en">
  <head>
    <title>åŸºé‡‘æŸ¥è¯¢</title>
    <style>
      th:nth-child(2), td:nth-child(2) {
        min-width: 200px;
        text-align: left;
        padding-left: 15px;
        position: relative;
        border-right: 2px solid transparent;
        transition: border-right-color 0.2s;
      }
      th:nth-child(20), td:nth-child(20) {
        min-width: 260px;
        text-align: left;
        white-space: normal;
      }
      th:nth-child(2)::after {
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
        content: "";
        position: absolute;
        right: -8px;
        top: 0;
        bottom: 0;
        width: 16px;
        cursor: col-resize;
      }
      th:nth-child(2):hover {
        border-right-color: #c966ea;
      }

      body {
        font-family: Arial,sans-serif;
        background: #667eea;
        color: #999;
        padding: 20px
      }

      .container {
        max-width: 1600px;
        margin: 0 auto; padding: 0 20px
      }

      table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        color: black
      }

      th, td {
        min-width: 68px;
        padding: 10px;
        border: 1px solid #ddd;
        text-align: center
      }

      th {
        background: #667eea;
        color: white
      }
    </style>
  </head>
  <body>
    <div class="container"><h1>ğŸ“Š åŸºé‡‘æ•°æ®æŸ¥è¯¢</h1>
      <label><input id="search" placeholder="æœç´¢åŸºé‡‘ä»£ç "></label>
      <button onclick="search()">æœç´¢</button>
      <button onclick="loadData()">é‡ç½®</button>
      <div class="controls" style="margin:20px 0;padding:15px;background:rgba(255,255,255,0.1);border-radius:8px">
        <div style="margin-bottom:10px;font-weight:bold">åˆ—æ˜¾ç¤ºè®¾ç½®:</div>
        <label><input type="checkbox" id="col0" checked onchange="toggleColumn(0)"> ä»£ç </label>
        <label><input type="checkbox" id="col1" checked onchange="toggleColumn(1)"> åç§°</label>
        <label><input type="checkbox" id="col2" onchange="toggleColumn(2)"> å†å²æœ€é«˜</label>
        <label><input type="checkbox" id="col3" onchange="toggleColumn(3)"> å†å²æœ€ä½</label>
        <label><input type="checkbox" id="col4" checked onchange="toggleColumn(4)"> TP20</label>
        <label><input type="checkbox" id="col5" checked onchange="toggleColumn(5)"> TP80</label>
        <label><input type="checkbox" id="col6" checked onchange="toggleColumn(6)"> TP15</label>
        <label><input type="checkbox" id="col7" checked onchange="toggleColumn(7)"> TP85</label>
        <label><input type="checkbox" id="col8" onchange="toggleColumn(8)"> 1å¹´æœ€é«˜</label>
        <label><input type="checkbox" id="col9" onchange="toggleColumn(9)"> 1å¹´æœ€ä½</label>
        <label><input type="checkbox" id="col10" checked onchange="toggleColumn(10)"> 90å¤©æœ€é«˜</label>
        <label><input type="checkbox" id="col11" checked onchange="toggleColumn(11)"> 90å¤©æœ€ä½</label>
        <label><input type="checkbox" id="col12" checked onchange="toggleColumn(12)"> ä¸Šæœˆæœ€é«˜</label>
        <label><input type="checkbox" id="col13" checked onchange="toggleColumn(13)"> ä¸Šæœˆæœ€ä½</label>
        <label><input type="checkbox" id="col14" onchange="toggleColumn(14)"> æœ¬æœˆæœ€é«˜</label>
        <label><input type="checkbox" id="col15" onchange="toggleColumn(15)"> æœ¬æœˆæœ€ä½</label>
        <label><input type="checkbox" id="col16" checked onchange="toggleColumn(16)"> å½“æ—¥ä¼°å€¼</label>
        <label><input type="checkbox" id="col17" checked onchange="toggleColumn(17)"> å½“æ—¥æ¶¨å¹…</label>
        <label><input type="checkbox" id="col18" checked onchange="toggleColumn(18)"> ä¼°å€¼çŠ¶æ€</label>
        <label><input type="checkbox" id="col19" onchange="toggleColumn(19)"> æŠ•èµ„å»ºè®®</label>
        <label><input type="checkbox" id="col20" checked onchange="toggleColumn(20)"> é¢„æœŸå¹´åŒ–æ”¶ç›Š</label>
        <br><br>
        <button onclick="showAllColumns()" style="padding:8px 16px;background:white;color:#667eea;border:none;border-radius:4px;cursor:pointer;font-weight:bold;margin-right:10px">æ˜¾ç¤ºå…¨éƒ¨</button>
        <button onclick="hideAllColumns()" style="padding:8px 16px;background:white;color:#667eea;border:none;border-radius:4px;cursor:pointer;font-weight:bold">éšè—å…¨éƒ¨</button>
        <button onclick="resetToDefault()" style="padding:8px 16px;background:white;color:#667eea;border:none;border-radius:4px;cursor:pointer;font-weight:bold">æ¢å¤é»˜è®¤</button>
      </div>
      <table id="table" style="display:none">
        <thead>
        <tr>
          <th>ä»£ç </th>
          <th>åç§°</th>
          <th>å†å²æœ€é«˜</th>
          <th>å†å²æœ€ä½</th>
          <th>TP20</th>
          <th>TP80</th>
          <th>TP15</th>
          <th>TP85</th>
          <th>1å¹´æœ€é«˜</th>
          <th>1å¹´æœ€ä½</th>
          <th>90å¤©æœ€é«˜</th>
          <th>90å¤©æœ€ä½</th>
          <th>ä¸Šæœˆæœ€é«˜</th>
          <th>ä¸Šæœˆæœ€ä½</th>
          <th>æœ¬æœˆæœ€é«˜</th>
          <th>æœ¬æœˆæœ€ä½</th>
          <th>å½“æ—¥ä¼°å€¼</th>
          <th>å½“æ—¥æ¶¨å¹…</th>
          <th>ä¼°å€¼çŠ¶æ€</th>
          <th>æŠ•èµ„å»ºè®®</th>
          <th>é¢„æœŸå¹´åŒ–æ”¶ç›Š</th>
        </tr>
        </thead>
        <tbody id="body"></tbody>
      </table>
      <div id="msg"></div>
    </div>
    <script>
      const API = window.location.origin;
      const DEFAULT_COLUMN_STATES=[
        true,   // 0: ä»£ç 
        true,   // 1: åç§°
        false,  // 2: å†å²æœ€é«˜ (éšè—)
        false,  // 3: å†å²æœ€ä½ (éšè—)
        true,   // 4: TP20
        true,   // 5: TP80
        true,   // 6: TP15
        true,   // 7: TP85
        false,  // 8: 1å¹´æœ€é«˜ (éšè—)
        false,  // 9: 1å¹´æœ€ä½ (éšè—)
        true,   // 10: 90å¤©æœ€é«˜
        true,   // 11: 90å¤©æœ€ä½
        true,   // 12: ä¸Šæœˆæœ€é«˜
        true,   // 13: ä¸Šæœˆæœ€ä½
        false,  // 14: æœ¬æœˆæœ€é«˜ (éšè—)
        false,  // 15: æœ¬æœˆæœ€ä½ (éšè—)
        true,   // 16: å½“æ—¥ä¼°å€¼
        true,   // 17: å½“æ—¥æ¶¨å¹…
        true,   // 18: ä¼°å€¼çŠ¶æ€
        false,   // 19: æŠ•èµ„å»ºè®® (éšè—)
        true    // 20: é¢„æœŸå¹´åŒ–æ”¶ç›Š
      ];

      let columnStates = [...DEFAULT_COLUMN_STATES];

      function loadData() {
        fetch(API + "/fund").then(r => r.json()).then(d => {
          if (d.code === 0) {
            show(d.data)
          } else {
            msg("å¤±è´¥")
          }
        }).catch(e => msg("é”™è¯¯: " + e.message))
      }

      function search() {
        const c = document.getElementById("search").value;
        if (!c) {
          msg("è¯·è¾“å…¥ä»£ç ");
          return
        }
        fetch(API + "/funds/" + c).then(r => r.json()).then(d => {
          if (d.code === 0) {
            show(d.data)
          } else {
            msg("å¤±è´¥")
          }
        }).catch(e => msg("é”™è¯¯: " + e.message))
      }

      function formatExpectedReturn(min, max) {
        if (!min || !max || min <= 0 || max <= 0) {
          return "-";
        }
        const minP = Math.round(min * 100);
        const maxP = Math.round(max * 100);
        return `${minP}% ~ ${maxP}%`;
      }

      function show(d) {
        const body = document.getElementById("body");
        body.innerHTML = "";
        d.forEach(item => {
          const row = document.createElement("tr");
          row.innerHTML = `<td>${item.FundCode}</td>
                           <td>${item.Name}</td>
                           <td>${fmt(item.HistoryMaxDwjz)}</td>
                           <td>${fmt(item.HistoryMinDwjz)}</td>
                           <td>${fmt(item.Tp80MinDwjz)}</td>
                           <td>${fmt(item.Tp80MaxDwjz)}</td>
                           <td>${fmt(item.Tp85MinDwjz)}</td
                           ><td>${fmt(item.Tp85MaxDwjz)}</td>
                           <td>${fmt(item.LastYearMaxDwjz)}</td>
                           <td>${fmt(item.LastYearMinDwjz)}</td>
                           <td>${fmt(item.LastSeasonMaxDwjz)}</td>
                           <td>${fmt(item.LastSeasonMinDwjz)}</td>
                           <td>${fmt(item.LastMonthMaxDwjz)}</td>
                           <td>${fmt(item.LastMonthMinDwjz)}</td>
                           <td>${fmt(item.MaxDwjz)}</td>
                           <td>${fmt(item.MinDwjz)}</td>
                           <td>${fmt(item.Gsz)}</td>
                           <td>${item.GszzlFormat}</td>
                           <td>${item.valuationStatus || "-"}</td>
                           <td>${item.investAdvice || "-"}</td>
                           <td>${formatExpectedReturn(item.expectedReturnMin, item.expectedReturnMax)}</td>`;
          body.appendChild(row)
        });
        document.getElementById("table").style.display = "table"
        applyColumnVisibility()
      }

      function fmt(n) {
        return n ? parseFloat(n).toFixed(4) : "-"
      }

      function toggleColumn(i) {
        columnStates[i] = !columnStates[i];
        document.getElementById("col" + i).checked = columnStates[i];
        applyColumnVisibility()
      }

      function applyColumnVisibility() {
        const t = document.getElementById("table");
        if (!t) {
          return;
        }
        t.querySelectorAll("tr").forEach(r => {
          r.querySelectorAll("th,td").forEach((c, i) => {
            c.style.display = columnStates[i] ? "" : "none"
          })
        })
      }

      function showAllColumns() {
        for (let i = 0; i < DEFAULT_COLUMN_STATES.length; i++) {
          columnStates[i] = true;
          document.getElementById("col" + i).checked = true
        }
        applyColumnVisibility()
      }

      function hideAllColumns() {
        for (let i = 0; i < DEFAULT_COLUMN_STATES.length; i++) {
          columnStates[i] = false;
          document.getElementById("col" + i).checked = false
        }
        applyColumnVisibility()
      }

      function resetToDefault() {
        for (let i = 0; i < DEFAULT_COLUMN_STATES.length; i++) {
          columnStates[i] = DEFAULT_COLUMN_STATES[i];
          document.getElementById("col" + i).checked = columnStates[i]
        }
        applyColumnVisibility()
      }

      let isResizing = false;
      let startX = 0;
      let startWidth = 0;

      function initColumnResize() {
        const th = document.querySelector("th:nth-child(2)");
        if (!th) {
          return;
        }
        th.addEventListener("mousedown", function (e) {
          if (e.offsetX > th.offsetWidth - 10) {
            isResizing = true;
            startX = e.clientX;
            startWidth = th.offsetWidth;
            e.preventDefault()
          }
        });
        document.addEventListener("mousemove", function (e) {
          if (!isResizing) {
            return;
          }
          const diff = e.clientX - startX;
          const newWidth = Math.max(200, startWidth + diff);
          const cells = document.querySelectorAll("th:nth-child(2),td:nth-child(2)");
          cells.forEach(cell => {
            cell.style.minWidth = newWidth + "px"
          })
        });
        document.addEventListener("mouseup", function () {
          isResizing = false
        })
      }

      window.addEventListener("load", function () {
        initColumnResize();
        loadData();
      });

    </script>
  </body>
</html>